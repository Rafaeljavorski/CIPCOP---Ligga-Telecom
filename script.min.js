let dados=[];document.getElementById("fileInput").addEventListener("change",function(e){const t=e.target.files[0];t&&Papa.parse(t,{header:!0,skipEmptyLines:!0,complete:function(e){dados=e.data.filter(e=>Object.values(e).some(e=>e&&""!==e.trim())),console.log(`CSV importado com sucesso: ${dados.length} linhas válidas`),atualizarDashboard()},error:function(e){console.error("Erro ao ler CSV:",e),alert("Falha ao ler o arquivo CSV. Verifique o formato e tente novamente.")}})});function atualizarDashboard(){0!==dados.length&&(atualizarTabela(),atualizarGraficos())}function atualizarTabela(){const e=document.getElementById("tabelaDados");e&&(e.innerHTML="",dados.forEach(t=>{const a=document.createElement("tr");a.innerHTML=`<td>${t.Recurso||""}</td><td>${t["Tipo de Atividade"]||""}</td><td>${t.Status||""}</td><td>${t["Data de Criação"]||""}</td>`,e.appendChild(a)}))}function atualizarGraficos(){atualizarGraficoAtividadesPorRecurso(),atualizarGraficoStatus(),atualizarGraficoTipos()}function atualizarGraficoAtividadesPorRecurso(){const e=document.getElementById("graficoRecurso");if(!e)return;const t={};dados.forEach(e=>{const a=e.Recurso||"Desconhecido";t[a]=(t[a]||0)+1});const a=Object.keys(t),r=Object.values(t);new Chart(e,{type:"bar",data:{labels:a,datasets:[{label:"Atividades por Recurso",data:r,borderWidth:1}]},options:{responsive:!0,plugins:{legend:{display:!1},tooltip:{enabled:!0}},scales:{y:{beginAtZero:!0}}}})}function atualizarGraficoStatus(){const e=document.getElementById("graficoStatus");if(!e)return;const t={};dados.forEach(e=>{const a=e.Status||"Sem Status";t[a]=(t[a]||0)+1});const a=Object.keys(t),r=Object.values(t);new Chart(e,{type:"pie",data:{labels:a,datasets:[{label:"Status das Atividades",data:r}]},options:{responsive:!0,plugins:{legend:{position:"bottom"},tooltip:{callbacks:{label:function(e){const t=r.reduce((e,t)=>e+t,0),a=(e.parsed/t*100).toFixed(1);return`${e.label}: ${e.parsed} (${a}%)`}}}}}})}function atualizarGraficoTipos(){const e=document.getElementById("graficoTipos");if(!e)return;const t={};dados.forEach(e=>{const a=e["Tipo de Atividade"]||"Sem Tipo";t[a]=(t[a]||0)+1});const a=Object.keys(t),r=Object.values(t);new Chart(e,{type:"doughnut",data:{labels:a,datasets:[{label:"Tipos de Atividade",data:r}]},options:{responsive:!0,plugins:{legend:{position:"bottom"},tooltip:{callbacks:{label:function(e){const t=r.reduce((e,t)=>e+t,0),a=(e.parsed/t*100).toFixed(1);return`${e.label}: ${e.parsed} (${a}%)`}}}}}})}
